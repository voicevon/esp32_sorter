# 主函数核心控制逻辑

## 1. 概述
控制ESP32分拣系统的核心逻辑，根据用户输入管理系统模式切换。

## 2. 主要组件
- **Sorter**：管理正常工作模式下的核心功能，包括直径扫描、数据存储、出口控制和上料器控制
- **SimpleHMI**：处理用户输入（按钮）和LED显示（模式指示）

## 3. 工作流程
- 主函数通过SimpleHMI的按钮输入管理系统模式切换
- 编码器触发相位变化时自动调用Sorter::onPhaseChange()，该方法仅设置相应的状态标志位
- 主循环中周期性调用sorter.spinOnce()，无论当前处于何种模式
- spinOnce()方法根据设置的标志位执行相应的功能：
  - 重置扫描仪状态
  - 处理扫描数据并存储到TraySystem
  - 预设出口状态
  - 执行出口控制动作
  - 控制上料器舵机的开关动作
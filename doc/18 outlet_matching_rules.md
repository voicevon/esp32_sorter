# 出口匹配规则

## 1. 概述
本文档详细描述了分拣系统中各出口的匹配规则，定义了不同直径范围的物体将被分配到哪个出口，以及完整的匹配和执行流程。

## 2. 出口匹配规则
系统共有5个固定安装的出口，每个出口对应特定的直径范围或条件：

- **出口0**：用于扫描次数大于1的物体，作为特殊处理出口（可能是重叠物体或特殊情况）
- **出口1**：用于直径大于13mm的物体（大尺寸芦笋）
- **出口2**：用于直径大于10mm且小于等于13mm的物体（中尺寸芦笋）
- **出口3**：用于直径大于8mm且小于等于10mm的物体（中小尺寸芦笋）
- **出口4**：用于直径大于等于6mm且小于等于8mm的物体（小尺寸芦笋）
- **小于8mm的物体**：不属于过滤范围，将从尾端流出，作为默认处理

**注**：直径计算标准为毫米数 = unit值 / 2（取整数），其中unit值是直径扫描仪的原始输出值。

## 3. 匹配流程
1. 系统通过DiameterScanner获取物体直径数据和扫描次数
2. **数据采集时机**：当编码器计数达到特定位置（对应相位值50）时，直径和扫描次数数据被添加到TraySystem中存储
3. 匹配规则实现：
   - 匹配逻辑在Sorter类的presetOutlets()方法中实现，而非Outlet类内部
   - Sorter根据预设的直径范围参数，决定哪些出口需要预先打开
4. 执行流程：
   - 系统首先调用presetOutlets()设置出口预开状态
   - **执行时机**：当编码器计数达到特定位置（对应相位值80）时，执行所有出口的分拣动作
   - **复位时机**：当编码器计数达到特定位置（对应相位值195）时，所有出口复位关闭，准备下一次分拣

## 4. 无效数据处理
- 无效直径值定义为0，表示该位置没有检测到物体
- 对于无效数据，系统不会触发任何出口动作，直接进入下一个检测周期

## 5. 上料器控制
- **开启时机**：当编码器计数达到特定位置（对应相位值200）时，上料器舵机打开
- **关闭时机**：当编码器计数达到特定位置（对应相位值220）时，上料器舵机关闭
- **控制方式**：通过舵机角度变化实现上料器的开启和关闭，开启角度为90度，关闭角度为0度
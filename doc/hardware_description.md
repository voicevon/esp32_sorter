# ESP32 Sorter 项目硬件说明

## 1. 核心开发板

- **型号**：ESP32 Dev Module
- **主要功能**：
  - 双核心Xtensa LX6微处理器，主频高达240MHz
  - 支持WiFi和蓝牙功能
  - 内置4MB Flash存储
  - 多种外设接口：GPIO、UART、SPI、I2C、ADC等

## 2. 编码器模块

- **类型**：100线增量式编码器
- **分辨率**：100脉冲/转
- **引脚说明**：
  - **A相**：编码脉冲信号A
  - **B相**：编码脉冲信号B
  - **Z相**：零位信号（每转输出一个脉冲，用于归零）

## 3. 激光距离传感器

- **类型**：开关量输出激光距离传感器
- **工作原理**：通过发射激光并接收反射信号，检测目标物体距离
- **输出特性**：
  - 当物体距离小于设定阈值时：输出低电平（0V）
  - 当物体距离大于设定阈值时：输出高电平（3.3V/5V）
- **探测距离**：可调节，根据实际应用需求设置

## 4. 舵机模块

- **类型**：标准舵机（SG90或类似型号）
- **数量**：系统共使用5个舵机
- **控制方式**：PWM信号控制
- **旋转角度范围**：0°-180°
- **舵机特性**：
  - PWM频率：50Hz（20ms周期）
  - 脉冲宽度：0.5ms-2.5ms（对应0°-180°）

## 5. 调试模块（Debugger）

- **组件**：
  - 2个按钮：用于系统控制和调试
  - 2个LED：用于状态指示
- **按钮特性**：
  - 触发方式：下降沿触发中断
  - 去抖处理：软件去抖（50ms延迟）
  - 内部上拉电阻：启用
- **LED特性**：
  - 控制方式：GPIO直接控制
  - 支持功能：开关、切换状态、闪烁
  - 典型电流：10-20mA（建议串联220Ω电阻）

## 6. 引脚连接建议

| 硬件组件 | ESP32引脚 | 功能说明 |
|----------|-----------|----------|
| 编码器A相 | GPIO 25 | A相输入信号 |
| 编码器B相 | GPIO 26 | B相输入信号 |
| 编码器Z相 | GPIO 27 | 零位信号输入 |
| 激光传感器 | GPIO 14 | 传感器信号输入 |
| 舵机1 | GPIO 2 | PWM控制信号 |
| 舵机2 | GPIO 4 | PWM控制信号 |
| 舵机3 | GPIO 5 | PWM控制信号 |
| 舵机4 | GPIO 18 | PWM控制信号 |
| 舵机5 | GPIO 19 | PWM控制信号 |
| 调试按钮1 | GPIO 32 | 按钮输入（带中断） |
| 调试按钮2 | GPIO 33 | 按钮输入（带中断） |
| 调试LED1 | GPIO 23 | LED输出 |
| 调试LED2 | GPIO 15 | LED输出 |
| 编码器VCC | 3.3V | 电源正极 |
| 激光传感器VCC | 3.3V | 电源正极 |
| 调试模块VCC | 3.3V | 电源正极 |
| 舵机VCC | 5V | 电源正极（建议使用外部电源） |
| 所有GND | GND | 电源负极（共地） |

## 6. 编码器工作原理

- **A相和B相**：输出相差90度的方波信号，通过检测A相和B相的相位关系可以确定旋转方向
  - 顺时针旋转：A相领先B相
  - 逆时针旋转：B相领先A相
- **Z相**：每旋转一周输出一个脉冲，用于确定绝对零位位置
- **采样机制**：编码器每旋转一个刻度（对应角度变化），系统会采样一次激光传感器的状态
- **数据处理点**：当编码器转到第185刻度（一圈结束位置）时，系统会读取缓冲区中激光传感器的数值，通过统计连续低电平的个数来确定被测物体（如芦笋）的直径

## 7. 激光传感器工作原理

- **工作模式**：非接触式距离检测
- **信号特性**：
  - 当传感器检测到物体距离较近时（小于设定阈值），输出低电平，表示有物体在近距离范围内
  - 当没有检测到近距离物体时，输出高电平
- **采样与数据处理**：
  - 系统在编码器每个刻度位置采样传感器状态
  - 采样数据存储在缓冲区中
  - 当编码器到达第185刻度时，系统分析缓冲区数据，统计连续低电平的宽度，从而计算出物体的直径

## 8. 舵机控制原理

- **PWM控制**：通过调节PWM信号的脉冲宽度来控制舵机角度
  - 0.5ms脉冲宽度：对应0°位置
  - 1.5ms脉冲宽度：对应90°位置（中间位置）
  - 2.5ms脉冲宽度：对应180°位置
- **控制方式**：
  - 直接角度设置：立即将舵机移动到指定角度
  - 平滑移动：通过逐步改变角度值，实现舵机的平滑转动
- **多舵机管理**：系统支持同时管理最多5个舵机，可实现同步或独立控制



## 9. 安装注意事项

- **编码器安装**：
  - 确保编码器与旋转轴连接牢固，避免打滑
  - 连接线应尽量短，减少干扰
  - 必要时可在信号线上增加10-100Ω的上拉电阻提高信号稳定性

- **激光传感器安装**：
  - 安装位置应确保激光束能够准确照射到被测物体
  - 避免强光直射传感器，可能导致检测不准确
  - 定期清洁传感器镜头，确保检测精度

- **舵机安装**：
  - 舵机应固定牢固，避免工作时产生振动
  - 舵机与机械结构的连接应顺畅，避免卡死
  - 舵机电源线应足够粗，避免大电流导致电压下降

- **调试模块安装**：
  - 按钮应安装在便于操作的位置
  - LED应安装在便于观察的位置
  - LED应串联220Ω电阻限流
  - 按钮应确保良好的接触，避免接触不良

- **布线注意事项**：
  - 编码器和传感器信号线应与动力线分开布线，避免电磁干扰
  - 建议使用屏蔽线缆连接敏感信号
  - 所有设备应确保良好接地

## 10. 调试建议

- **编码器调试**：
  - 使用示波器或逻辑分析仪测量A相和B相信号的相位关系
  - 通过读取Z相脉冲确认编码器是否每转一圈产生正确的零位信号
  - 旋转编码器时观察计数变化，验证方向检测是否正确

- **激光传感器调试**：
  - 使用已知直径的物体测试传感器检测精度
  - 调整传感器灵敏度或阈值，优化检测效果
  - 观察采样数据，确保在物体通过时能正确记录低电平信号

- **舵机调试**：
  - 测试每个舵机的0°、90°和180°位置是否准确
  - 调整PWM参数，使舵机运动平滑无抖动
  - 测试多舵机同步控制的协调性

- **调试模块调试**：
  - 按下按钮1，验证LED1状态是否切换，编码器计数是否重置
  - 按下按钮2，验证LED2状态是否切换，所有舵机是否回到90度位置
  - 检查LED1是否以500ms间隔闪烁，表示系统正常运行
  - 验证按钮中断响应是否及时，无明显延迟